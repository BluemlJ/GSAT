package gui;

import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.LinkedList;

import analysis.AnalysedSequence;
import analysis.Gene;
import analysis.MutationAnalysis;
import analysis.Pair;
import analysis.QualityAnalysis;
import analysis.StringAnalysis;
import exceptions.ConfigNotFoundException;
import exceptions.ConfigReadException;
import exceptions.CorruptedSequenceException;
import exceptions.FileReadingException;
import exceptions.MissingPathException;
import exceptions.UndefinedTypeOfMutationException;
import io.Config;
import io.ConsoleIO;
import io.FileSaver;
import io.GeneReader;
import io.SequenceReader;
import javafx.scene.control.TextField;

public class GUIUtils {

  public static void runAnalysis(LinkedList<File> sequences) {
    boolean success = false;
    String report = "Failure within the analysing process, unknown reason"
    Gene gene = GeneReader.getGeneAt(0); // TODO DROPDOWN EINBINDEN
    for (File file : sequences) {
      AnalysedSequence toAnalyse = readSequenceFromFile(file).first;
      toAnalyse.setReferencedGene(gene);

      try {
        StringAnalysis.checkComplementAndReverse(toAnalyse);
      } catch (CorruptedSequenceException e) {
        // TODO HIER FEHLER ANBRINGEN
        e.printStackTrace();

        // cut out vector
        StringAnalysis.trimVector(toAnalyse);

        // cut out low Quality parts of sequence
        QualityAnalysis.trimLowQuality(toAnalyse);

        // mutation analysis
       

        
        // add entry to database
        try {
          FileSaver.storeResultsLocally(file.getName().replaceFirst("[.][^.]+$", "") + "_result",
              toAnalyse);
        } catch (MissingPathException e2) {
          FileSaver.setLocalPath("");
        } catch (IOException e2) {
          // TODO Auto-generated catch block
          e.printStackTrace();
        }

      }
    }

  }


  private static void runTrimming() {

  }

  private static void runMutationAnalysis() {

  }

  private static void runDocumentation() {

  }

  private static Pair<Pair<LinkedList<File>, LinkedList<File>>, Pair<Boolean, String>> getSequencesFromSourceFolder(
      TextField source) {
    String report = "Reading Sequences unsuccessfull with unknown error";
    boolean success = false;

    LinkedList<File> files = null;
    LinkedList<File> oddFiles = null;

    io.SequenceReader.configurePath(source.getText());
    Pair<LinkedList<File>, LinkedList<File>> fileLists = io.SequenceReader.listFiles();
    files = fileLists.first;
    oddFiles = fileLists.second;

    if (files.isEmpty()) {
      report = "No AB1 files were found at the given path.";
    } else {
      report = "Reading sequences successfull";
      success = true;
    }

    Pair<LinkedList<File>, LinkedList<File>> one =
        new Pair<LinkedList<File>, LinkedList<File>>(files, oddFiles);
    Pair<Boolean, String> two = new Pair<Boolean, String>(success, report);

    return new Pair<Pair<LinkedList<File>, LinkedList<File>>, Pair<Boolean, String>>(one, two);
  }

  private static Pair<Boolean, String> setDestination(TextField destination) {
    boolean success = false;
    String report = "Reading destinationpath was unsuccessfull.";
    String path = null;
    try {
      path = ConsoleIO.readLine(destination.getText());
      success = true;
      report = "Reading destinationpath successfull.";
    } catch (IOException e) {
      report = "Reading destinationpath unsuccessfull, IOExeption";
      e.printStackTrace();
    }
    // set destination path for database entries
    FileSaver.setLocalPath(path);
    return new Pair<Boolean, String>(success, report);
  }

  private static Pair<Boolean, String> runConfiguration(TextField configpath) {
    Config.setPath(configpath.getText());
    boolean success = false;
    String report = "Reading configfile unsuccessfull with unknown error";
    try {
      Config.readConfig();
      success = true;
      report = "Reading configfile successfull";
    } catch (ConfigReadException e) {
      report = "An error occured while reading the configuration file.";
    } catch (ConfigNotFoundException e) {
      report = "No configuration file was found at the given path.";
    } catch (IOException e) {
      System.out.println("Error during reading occurred.");
    }
    return new Pair<Boolean, String>(success, report);
  }

  /**
   * Reads the Sequence of the given File and prints Errors if necessary
   * 
   * @param file
   * @return
   * @author Jannis
   */
  private static Pair<AnalysedSequence, Pair<Boolean, String>> readSequenceFromFile(File file) {
    String report = "Failure with" + file.getAbsolutePath() + "\n This file might be corrupted.";
    boolean success = false;
    Pair<Boolean, String> ret = new Pair<Boolean, String>(success, report);
    try {
      success = true;
      report = "";
      ret = new Pair<Boolean, String>(success, report);
      return new Pair<AnalysedSequence, Pair<Boolean, String>>(
          SequenceReader.convertFileIntoSequence(file), ret);
    } catch (FileReadingException e) {} catch (IOException e) {}
    return new Pair<AnalysedSequence, Pair<Boolean, String>>(null, ret);
  }
}


